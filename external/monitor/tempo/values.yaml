tempo-distributed:
  multitenancyEnabled: true
  global:
    dnsService: rke2-coredns-rke2-coredns
    dnsNamespace: kube-system
  revisionHistoryLimit: 1
  tempo:
    structuredConfig:
      # Global compactor configuration
      compactor:
        compaction:
          block_retention: 720h  # 30 days default
      # Per-tenant overrides
      overrides:
        defaults:
          metrics_generator:
            processors: []
        per_tenant_override_config: /runtime-config/overrides.yaml
  search:
    enabled: true
  distributor:
    service:
      type: NodePort
    extraArgs:
      - -config.expand-env=true
    extraEnvFrom:
      - secretRef:
          name: tempo-storage-secret
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: tempo-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /runtime-config
        readOnly: true
  queryFrontend:
    extraArgs:
      - -config.expand-env=true
    extraEnvFrom:
      - secretRef:
          name: tempo-storage-secret
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: tempo-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /runtime-config
        readOnly: true
  querier:
    extraArgs:
      - -config.expand-env=true
    extraEnvFrom:
      - secretRef:
          name: tempo-storage-secret
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: tempo-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /runtime-config
        readOnly: true
  compactor:
    extraArgs:
      - -config.expand-env=true
    extraEnvFrom:
      - secretRef:
          name: tempo-storage-secret
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: tempo-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /runtime-config
        readOnly: true
  ingester:
    extraArgs:
      - -config.expand-env=true
    extraEnvFrom:
      - secretRef:
          name: tempo-storage-secret
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: tempo-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /runtime-config
        readOnly: true
  metricsGenerator:
    enabled: true
    extraArgs:
      - -config.expand-env=true
    extraEnvFrom:
      - secretRef:
          name: tempo-storage-secret
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: tempo-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /runtime-config
        readOnly: true
  minio:
    enabled: false
  storage:
    trace:
      backend: s3
      s3:
        bucket: tempo
        endpoint: cloud.gerega.net:3900
        access_key: ${STORAGE_USERNAME}
        secret_key: ${STORAGE_PASSWORD}
        forcepathstyle: true
        insecure: true
  traces:
    jaeger:
      grpc:
        enabled: true
      thriftBinary:
        enabled: true
      thriftCompact:
        enabled: true
      thriftHttp:
        enabled: true
    zipkin:
      enabled: true
    otlp:
      grpc:
        enabled: true
      http:
        enabled: true
  gateway:
    enabled: true
    service:
      labels:
        mirror.linkerd.io/exported: "true"
    ingress:
      enabled: false  # Migrated to Gateway API HTTPRoute
      hosts:
        - host: "tempo.mattgerega.net"
          paths:
            - path: /
              pathType: Prefix
      annotations:
        kubernetes.io/ingress.class: nginx
      tls: []
