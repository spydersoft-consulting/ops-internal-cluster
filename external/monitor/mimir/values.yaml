mimir-distributed:
  global:
    dnsService: rke2-coredns-rke2-coredns
    dnsNamespace: kube-system
    extraEnvFrom:
      - secretRef:
          name: mimir-storage-secret
  minio:
    enabled: false
  kafka:
    enabled: true
    persistence:
      storageClassName: nfs-client
  alertmanager:
    enabled: true
    persistentVolume:
      storageClass: nfs-client
  distributor:
    replicas: 2
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: mimir-distributed-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /etc/mimir-runtime-overrides
        readOnly: true
  ingester:
    replicas: 3
    persistentVolume:
      storageClass: nfs-client
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: mimir-distributed-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /etc/mimir-runtime-overrides
        readOnly: true
  store_gateway:
    replicas: 3
    persistentVolume:
      storageClass: nfs-client
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: mimir-distributed-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /etc/mimir-runtime-overrides
        readOnly: true
  compactor:
    persistentVolume:
      storageClass: nfs-client
    extraVolumes:
      - name: runtime-overrides
        configMap:
          name: mimir-distributed-runtime-overrides
    extraVolumeMounts:
      - name: runtime-overrides
        mountPath: /etc/mimir-runtime-overrides
        readOnly: true
  chunks-cache:
    enabled: false
    replicas: 2
  index-cache:
    enabled: false
    replicas: 3
  results-cache:
    enabled: false
    replicas: 2
  ruler:
    enabled: true
  nginx:
    service:
      labels:
        mirror.linkerd.io/exported: "true"
  ingress:
    enabled: false  # Migrated to Gateway API HTTPRoute
    hosts:
      - mimir.mattgerega.net
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/service-upstream: "true"
    tls: []
  mimir:
    structuredConfig:
      # Runtime configuration for per-tenant overrides
      runtime_config:
        file: /etc/mimir-runtime-overrides/runtime-overrides.yaml
        period: 10s

      alertmanager_storage:
        backend: s3
        s3:
          access_key_id: ${STORAGE_USERNAME}
          bucket_name: mimir-ruler
          endpoint: cloud.gerega.net:3900
          insecure: true
          secret_access_key: ${STORAGE_PASSWORD}
      blocks_storage:
        s3:
          access_key_id: ${STORAGE_USERNAME}
          bucket_name: mimir-tsdb
          endpoint: cloud.gerega.net:3900
          insecure: true
          secret_access_key: ${STORAGE_PASSWORD}
      ruler_storage:
        backend: s3
        s3:
          access_key_id: ${STORAGE_USERNAME}
          bucket_name: mimir-ruler
          endpoint: cloud.gerega.net:3900
          insecure: true
          secret_access_key: ${STORAGE_PASSWORD}
      limits:
        max_global_series_per_user: 0
        ingestion_rate: 400000
        ingestion_burst_size: 1000000
        compactor_blocks_retention_period: 1y
        out_of_order_time_window:
  metaMonitoring:
    serviceMonitor:
      enabled: true
      interval: 1m
      scrapeTimeout: 30s
